{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - Credit Notes by Month{% endblock %}

{% block page_title %}
    <h2 class="page-title">Credit Notes by Month</h2>
{% endblock %}

{% block css %}
    {{ block.super }}
    <style>
        .clickable-row {
            cursor: pointer;
        }
        .clickable-row:hover {
            background-color: #f1f1f1;
        }
        .hidden {
            display: none;
        }
        .text-red-bold {
            color: red;
            font-weight: bold;
        }
        .container.mt-5 {
            margin-top: 2rem !important; /* Reduce the top margin */
        }
        .form-inline {
            margin-bottom: 20px;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="container mt-3">
        <form class="form-inline" method="GET" action="{% url 'monthly_credit_notes' %}">
            <label for="month">Month:</label>
            <select name="month" id="month" class="form-control ml-2">
                {% for month in months %}
                    <option value="{{ month.value }}" {% if month.value == selected_month %}selected{% endif %}>{{ month.name }}</option>
                {% endfor %}
            </select>

            <label for="year" class="ml-3">Year:</label>
            <select name="year" id="year" class="form-control ml-2">
                {% for year in years %}
                    <option value="{{ year }}" {% if year == selected_year %}selected{% endif %}>{{ year }}</option>
                {% endfor %}
            </select>

            <button type="submit" class="btn btn-primary ml-3">Submit</button>
        </form>

        <table class="table table-striped table-bordered">
            <thead class="thead-dark">
                <tr>
                    <th>Dealer Name</th>
                    <th>ID</th>
                    <th>Issued Date</th>
                    <th>Total Amount</th>
                    <th>Total VAT Amount</th>
                    <th>Total Amount + VAT</th>
                    <th>Acknowledgement Sent</th>
                    <th>Acknowledgement Received</th>
                </tr>
            </thead>
            <tbody>
                {% for credit_note_aggregated in credit_notes_aggregated %}
                    <tr class="clickable-row" onclick="toggleDetails('{{ credit_note_aggregated.D_ID|slugify }}-details')">
                        <td><strong>{{ credit_note_aggregated.D_ID__DealerName }}</strong></td>
                        <td>{{ credit_note_aggregated.D_ID }}</td>
                        <td></td>
                        <td><strong>{{ credit_note_aggregated.total_document_amount|floatformat:2 }}</strong></td>
                        <td><strong>{{ credit_note_aggregated.total_vat_amount|floatformat:2 }}</strong></td>
                        <td><strong>{{ credit_note_aggregated.total_document_amount_with_vat|floatformat:2 }}</strong></td>
                        <td class="text-red-bold">No</td>
                        <td class="text-red-bold">No</td>
                    </tr>
                    <tbody id="{{ credit_note_aggregated.D_ID|slugify }}-details" class="hidden">
                        {% for credit_note in credit_note_aggregated.credit_notes %}
                            <tr>
                                <td></td>
                                <td>{{ credit_note.CN_ID }}</td>
                                <td>{{ credit_note.IssuedDate|date:"F j, Y" }}</td>
                                <td>{{ credit_note.TotalDocumentAmount|floatformat:2 }}</td>
                                <td>{{ credit_note.TotalVATAmountDocumentt|floatformat:2 }}</td>
                                <td>{{ credit_note.TotalDocumentAmountWithVAT|floatformat:2 }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script src="{% static 'dashboard/js/toggleDetails.js' %}"></script>
{% endblock %}