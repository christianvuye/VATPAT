{% extends 'base.html' %}

{% block title %}Dashboard - Credit Notes Last Month{% endblock %}

{% block css %}
    {{ block.super }}
    <style>
        .clickable-row {
            cursor: pointer;
        }
        .clickable-row:hover {
            background-color: #f1f1f1;
        }
        .hidden {
            display: none;
        }
        .text-red-bold {
            color: red;
            font-weight: bold;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="container mt-5">
        <h1 class="mb-4">Dashboard - Credit Notes Last Month</h1>
        <table class="table table-striped table-bordered">
            <thead class="thead-dark">
                <tr>
                    <th>Dealer Name</th>
                    <th>ID</th>
                    <th>Issued Date</th>
                    <th>Total Amount</th>
                    <th>Total VAT Amount</th>
                    <th>Total Amount + VAT</th>
                    <th>Credit Note Resume Sent?</th>
                    <th>Acknowledgement Received?</th>
                </tr>
            </thead>
            <tbody>
                {% for dealer in unique_dealers %}
                    {% for dealer_key, totals in totals_per_dealer.items %}
                        {% if dealer_key == dealer %}
                            <tr class="clickable-row" onclick="toggleDetails('{{ dealer|slugify }}-details')">
                                <td><strong>{{ dealer }}</strong></td>
                                <td></td>
                                <td></td>
                                <td><strong>{{ totals.TotalDocumentAmount|floatformat:2 }}</strong></td>
                                <td><strong>{{ totals.TotalVATAmountDocumentt|floatformat:2 }}</strong></td>
                                <td><strong>{{ totals.TotalDocumentAmountWithVAT|floatformat:2 }}</strong></td>
                                <td class="text-red-bold">No</td>
                                <td class="text-red-bold">No</td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                    <tbody id="{{ dealer|slugify }}-details" class="hidden">
                        {% for dealer_key, credit_notes in grouped_credit_notes.items %}
                            {% if dealer_key == dealer %}
                                {% for credit_note in credit_notes %}
                                    <tr>
                                        <td></td>
                                        <td>{{ credit_note.CN_ID }}</td>
                                        <td>{{ credit_note.IssuedDate|date:"F j, Y" }}</td>
                                        <td>{{ credit_note.TotalDocumentAmount|floatformat:2 }}</td>
                                        <td>{{ credit_note.TotalVATAmountDocumentt|floatformat:2 }}</td>
                                        <td>{{ credit_note.TotalDocumentAmountWithVAT|floatformat:2 }}</td>
                                    </tr>
                                {% endfor %}
                            {% endif %}
                        {% endfor %}
                    </tbody>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script>
        function toggleDetails(id) {
            console.log("Toggling details for: ", id);
            var element = document.getElementById(id);
            if (element.classList.contains('hidden')) {
                element.classList.remove('hidden');
            } else {
                element.classList.add('hidden');
            }
        }
    </script>
{% endblock %}